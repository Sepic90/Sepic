<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>sepic</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { 
      getAuth, 
      signInWithEmailAndPassword, 
      signOut,
      onAuthStateChanged 
    } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
    import {
      getFirestore,
      collection,
      getDocs,
      addDoc,
      updateDoc,
      deleteDoc,
      doc,
      query,
      orderBy
    } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
    import {
      getStorage,
      ref,
      uploadBytes,
      getDownloadURL
    } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js';

    // REPLACE WITH YOUR FIREBASE CONFIG
    const firebaseConfig = {
	  apiKey: "AIzaSyDlY-8BMRUH0GxPSIBRuExCX2cL9E9zd3Q",
	  authDomain: "sepic-426e1.firebaseapp.com",
	  projectId: "sepic-426e1",
	  storageBucket: "sepic-426e1.firebasestorage.app",
	  messagingSenderId: "233022179085",
	  appId: "1:233022179085:web:2a9c92c3e6aaac462c5244"
	};

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const storage = getStorage(app);

    // Main App
    class SepicHub {
      constructor() {
        this.user = null;
        this.links = [];
        this.showAdmin = false;
        this.editingLink = null;
        this.uploading = false;
        this.init();
      }

      init() {
        onAuthStateChanged(auth, (user) => {
          this.user = user;
          this.render();
        });
        this.fetchLinks();
      }

      async fetchLinks() {
        try {
          const q = query(collection(db, 'links'), orderBy('createdAt', 'asc'));
          const querySnapshot = await getDocs(q);
          this.links = querySnapshot.docs.map(doc => ({
            id: doc.id,
            ...doc.data()
          }));
          this.render();
        } catch (err) {
          console.error('Error fetching links:', err);
        }
      }

      async handleLogin(email, password) {
        try {
          await signInWithEmailAndPassword(auth, email, password);
        } catch (err) {
          alert('Invalid credentials');
        }
      }

      async handleLogout() {
        await signOut(auth);
        this.showAdmin = false;
        this.render();
      }

      async uploadLogo(file) {
        if (!file) return null;
        
        this.uploading = true;
        this.render();
        
        try {
          const storageRef = ref(storage, `logos/${Date.now()}_${file.name}`);
          await uploadBytes(storageRef, file);
          const url = await getDownloadURL(storageRef);
          this.uploading = false;
          return url;
        } catch (err) {
          console.error('Error uploading logo:', err);
          this.uploading = false;
          return null;
        }
      }

      async handleAddLink(name, url, logo, isPublic) {
        if (!name || !url) return;
        
        try {
          await addDoc(collection(db, 'links'), {
            name: name.toUpperCase(),
            url: url,
            logo: logo,
            isPublic: isPublic,
            createdAt: new Date()
          });
          await this.fetchLinks();
        } catch (err) {
          console.error('Error adding link:', err);
        }
      }

      async handleUpdateLink(id, name, url, logo, isPublic) {
        try {
          const linkRef = doc(db, 'links', id);
          await updateDoc(linkRef, {
            name: name.toUpperCase(),
            url: url,
            logo: logo,
            isPublic: isPublic
          });
          this.editingLink = null;
          await this.fetchLinks();
        } catch (err) {
          console.error('Error updating link:', err);
        }
      }

      async handleDeleteLink(id) {
        if (!confirm('Delete this link?')) return;
        try {
          await deleteDoc(doc(db, 'links', id));
          if (this.editingLink && this.editingLink.id === id) {
            this.editingLink = null;
          }
          await this.fetchLinks();
        } catch (err) {
          console.error('Error deleting link:', err);
        }
      }

      render() {
        const visibleLinks = this.user ? this.links : this.links.filter(link => link.isPublic);
        
        document.getElementById('root').innerHTML = `
          <style>
            * {
              font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
              font-weight: 300;
              letter-spacing: 0.05em;
            }

            @keyframes fadeIn {
              from { opacity: 0; }
              to { opacity: 1; }
            }

            @keyframes breathe {
              0%, 100% { 
                text-shadow: 0 0 30px rgba(255, 107, 237, 0.4);
              }
              50% { 
                text-shadow: 0 0 60px rgba(255, 107, 237, 0.6);
              }
            }

            .custom-bg {
              background-image: url('https://i.imgur.com/H0JGiuM.jpeg');
              background-size: cover;
              background-position: center;
              background-attachment: fixed;
            }

            .fade-in {
              animation: fadeIn 0.8s ease-out forwards;
            }

            .title-glow {
              animation: breathe 4s ease-in-out infinite;
              color: white;
            }

            .link-item {
              transition: all 0.15s ease;
              color: rgba(255, 255, 255, 0.95);
              text-decoration: none;
              display: flex;
              align-items: center;
              gap: 16px;
              font-size: 1.875rem;
            }

            .link-item:hover {
              color: rgba(255, 255, 255, 0.6);
            }

            .input-field {
              transition: border-color 0.15s ease;
              background: rgba(255, 255, 255, 0.1);
              color: white;
              border: none;
              border-bottom: 1px solid rgba(255, 255, 255, 0.3);
              padding: 8px 0;
              width: 100%;
              font-size: 0.875rem;
            }

            .input-field::placeholder {
              color: rgba(255, 255, 255, 0.5);
            }

            .input-field:focus {
              outline: none;
              border-color: rgba(255, 255, 255, 0.8);
              background: rgba(255, 255, 255, 0.15);
            }

            .btn-minimal {
              transition: all 0.15s ease;
              background: transparent;
              color: rgba(255, 255, 255, 0.9);
              border: none;
              cursor: pointer;
              padding: 8px 0;
            }

            .btn-minimal:hover {
              color: rgba(255, 255, 255, 0.6);
            }

            .admin-text {
              transition: all 0.15s ease;
              color: rgba(255, 255, 255, 0.7);
              background: transparent;
              border: none;
              cursor: pointer;
            }

            .admin-text:hover {
              color: rgba(255, 255, 255, 0.4);
            }

            h1 {
              font-weight: 700;
              letter-spacing: -0.02em;
              color: white;
              font-size: 6rem;
            }

            .label-text {
              color: rgba(255, 255, 255, 0.6);
            }

            .logo-img {
              width: 24px;
              height: 24px;
              object-fit: contain;
            }

            @media (min-width: 768px) {
              h1 { font-size: 8rem; }
              .link-item { font-size: 2.25rem; }
            }
          </style>

          <div class="min-h-screen flex items-center justify-center p-8 custom-bg">
            <div style="width: 100%; max-width: 56rem;">
              <div style="margin-bottom: 5rem;" class="fade-in">
                <h1 class="title-glow">sepic</h1>
              </div>

              <div style="margin-bottom: 5rem; animation-delay: 0.2s;" class="fade-in">
                ${visibleLinks.map(link => `
                  <div style="margin-bottom: 1.5rem;">
                    <a href="${link.url}" target="_blank" rel="noopener noreferrer" class="link-item">
                      ${link.logo ? `<img src="${link.logo}" alt="" class="logo-img" />` : ''}
                      ${link.name}
                    </a>
                  </div>
                `).join('')}
              </div>

              ${this.user && !this.showAdmin ? `
                <div style="margin-bottom: 5rem;" class="fade-in">
                  <button class="btn-minimal" style="font-size: 0.875rem;" onclick="app.showAdmin = true; app.render();">
                    MANAGE LINKS
                  </button>
                </div>
              ` : ''}

              ${!this.user ? `
                <div style="animation-delay: 0.4s;" class="fade-in">
                  <div style="max-width: 20rem;">
                    <form id="loginForm" style="display: flex; flex-direction: column; gap: 1rem;">
                      <input type="email" id="email" placeholder="EMAIL" class="input-field" required />
                      <input type="password" id="password" placeholder="PASSWORD" class="input-field" required />
                      <button type="submit" class="btn-minimal" style="text-align: left; margin-top: 1rem; font-size: 0.875rem;">
                        ENTER
                      </button>
                    </form>
                  </div>
                </div>
              ` : ''}

              ${this.user && this.showAdmin ? `
                <div class="fade-in" style="display: flex; flex-direction: column; gap: 3rem;">
                  <div style="display: flex; align-items: center; gap: 1.5rem; font-size: 0.75rem; margin-bottom: 2rem;">
                    <button class="admin-text" onclick="app.showAdmin = false; app.render();">CLOSE</button>
                    <button class="admin-text" onclick="app.handleLogout();">LOGOUT</button>
                  </div>

                  <form id="addLinkForm" style="max-width: 28rem; display: flex; flex-direction: column; gap: 1rem;">
                    <div class="label-text" style="font-size: 0.75rem; margin-bottom: 1.5rem;">ADD NEW LINK</div>
                    <input type="text" id="newName" placeholder="LINK TEXT" class="input-field" required />
                    <input type="url" id="newUrl" placeholder="URL" class="input-field" required />
                    <div style="padding-top: 0.5rem;">
                      <label class="btn-minimal" style="font-size: 0.75rem; cursor: pointer;">
                        ${this.uploading ? 'UPLOADING...' : 'UPLOAD LOGO'}
                        <input type="file" id="newLogo" accept="image/png,image/jpeg,image/svg+xml" style="display: none;" ${this.uploading ? 'disabled' : ''} />
                      </label>
                      <span id="logoStatus" class="label-text" style="margin-left: 1rem; font-size: 0.75rem;"></span>
                    </div>
                    <label style="display: flex; align-items: center; font-size: 0.75rem; padding-top: 0.5rem;" class="label-text">
                      <input type="checkbox" id="newPrivate" style="margin-right: 0.75rem;" />
                      PRIVATE
                    </label>
                    <button type="submit" class="btn-minimal" style="padding-top: 1rem; font-size: 0.875rem;" ${this.uploading ? 'disabled' : ''}>
                      ADD
                    </button>
                  </form>

                  <div style="padding-top: 2rem; border-top: 1px solid rgba(255, 255, 255, 0.2); display: flex; flex-direction: column; gap: 1.5rem;">
                    <div class="label-text" style="font-size: 0.75rem; margin-bottom: 1.5rem;">ALL LINKS</div>
                    ${this.links.map(link => `
                      <div style="display: flex; align-items: center; justify-content: space-between;">
                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                          ${link.logo ? `<img src="${link.logo}" alt="" class="logo-img" style="opacity: 0.7;" />` : ''}
                          <span style="font-size: 0.875rem;">${link.name}</span>
                          ${!link.isPublic ? '<span class="label-text" style="font-size: 0.75rem;">[PRIVATE]</span>' : ''}
                        </div>
                        <div style="display: flex; gap: 1rem; font-size: 0.75rem;">
                          <button class="admin-text" onclick='app.editingLink = ${JSON.stringify(link)}; app.render();'>EDIT</button>
                          <button class="admin-text" style="opacity: 0.6;" onclick="app.handleDeleteLink('${link.id}');">DELETE</button>
                        </div>
                      </div>
                    `).join('')}
                  </div>

                  ${this.editingLink ? `
                    <form id="editLinkForm" style="max-width: 28rem; padding-top: 2rem; border-top: 1px solid rgba(255, 255, 255, 0.2); display: flex; flex-direction: column; gap: 1rem;">
                      <div class="label-text" style="font-size: 0.75rem; margin-bottom: 1.5rem;">EDIT LINK</div>
                      <input type="text" id="editName" value="${this.editingLink.name}" placeholder="LINK TEXT" class="input-field" required />
                      <input type="url" id="editUrl" value="${this.editingLink.url}" placeholder="URL" class="input-field" required />
                      <div style="padding-top: 0.5rem;">
                        <label class="btn-minimal" style="font-size: 0.75rem; cursor: pointer;">
                          ${this.uploading ? 'UPLOADING...' : (this.editingLink.logo ? 'CHANGE LOGO' : 'UPLOAD LOGO')}
                          <input type="file" id="editLogo" accept="image/png,image/jpeg,image/svg+xml" style="display: none;" ${this.uploading ? 'disabled' : ''} />
                        </label>
                        <span id="editLogoStatus" class="label-text" style="margin-left: 1rem; font-size: 0.75rem;"></span>
                      </div>
                      <label style="display: flex; align-items: center; font-size: 0.75rem; padding-top: 0.5rem;" class="label-text">
                        <input type="checkbox" id="editPrivate" ${!this.editingLink.isPublic ? 'checked' : ''} style="margin-right: 0.75rem;" />
                        PRIVATE
                      </label>
                      <div style="display: flex; gap: 1.5rem; padding-top: 1rem; font-size: 0.875rem;">
                        <button type="submit" class="btn-minimal" ${this.uploading ? 'disabled' : ''}>SAVE</button>
                        <button type="button" class="btn-minimal admin-text" onclick="app.editingLink = null; app.render();">CANCEL</button>
                      </div>
                    </form>
                  ` : ''}
                </div>
              ` : ''}
            </div>
          </div>
        `;

        // Event listeners
        const loginForm = document.getElementById('loginForm');
        if (loginForm) {
          loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            this.handleLogin(email, password);
          });
        }

        const addLinkForm = document.getElementById('addLinkForm');
        if (addLinkForm) {
          let uploadedLogoUrl = '';
          
          const logoInput = document.getElementById('newLogo');
          logoInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (file) {
              uploadedLogoUrl = await this.uploadLogo(file);
              if (uploadedLogoUrl) {
                document.getElementById('logoStatus').textContent = 'LOGO UPLOADED';
              }
            }
          });

          addLinkForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('newName').value;
            const url = document.getElementById('newUrl').value;
            const isPrivate = document.getElementById('newPrivate').checked;
            await this.handleAddLink(name, url, uploadedLogoUrl, !isPrivate);
            addLinkForm.reset();
            uploadedLogoUrl = '';
          });
        }

        const editLinkForm = document.getElementById('editLinkForm');
        if (editLinkForm) {
          let editUploadedLogoUrl = this.editingLink.logo || '';
          
          const editLogoInput = document.getElementById('editLogo');
          editLogoInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (file) {
              editUploadedLogoUrl = await this.uploadLogo(file);
              if (editUploadedLogoUrl) {
                document.getElementById('editLogoStatus').textContent = 'LOGO UPLOADED';
              }
            }
          });

          editLinkForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('editName').value;
            const url = document.getElementById('editUrl').value;
            const isPrivate = document.getElementById('editPrivate').checked;
            await this.handleUpdateLink(this.editingLink.id, name, url, editUploadedLogoUrl, !isPrivate);
          });
        }
      }
    }

    // Initialize app
    if (!window.app) {
      window.app = new SepicHub();
    }
  </script>
</body>
</html>